@page "/"
@using Todo_Maui_Blazor.Components
@using Todo_Maui_Blazor.Models
@using Todo_Maui_Blazor.Services
@inject IDialogService DialogService
@inject ITodoService TodoService

@*<div Class="mud-theme-info px-3 py-6 mud-elevation-16 rounded-lg fixed text-center" style="bottom:25px;left:20px;z-index:1000" @onclick="NewItem">
    <MudText>
        افزودن مورد جدید
    </MudText>
</div>*@

<MudFab Icon="@Icons.Filled.Add" Color="@Color.Primary" Style="position:fixed;bottom:25px;left:25px" @onclick="NewItem" />

<br/>
<MudGrid  Justify="@Justify.Center">
    @foreach (var item in todos)
    {
        <Item Title="@item.Title" Text="@item.Text" Id="@item.Id" />
    }
</MudGrid>

@code {

    IEnumerable<Todo> todos = new List<Todo>();

    async void NewItem()
    {
        DialogOptions options = new() { CloseOnEscapeKey = false, DisableBackdropClick = true, FullWidth = true, CloseButton = true };
        var dialog = DialogService.Show<Upsert>("افزودن ایتم جدید", options);
        var result = await dialog.Result;
        if (!result.Cancelled)
        {
            if (((dynamic)result.Data).Status)
                todos.ToList().Add((Todo)((dynamic)result.Data).item);
        }
    }

    protected override async Task OnInitializedAsync()
    {
        await LoadItemsAsync();
    }

    async Task LoadItemsAsync()
    {
        todos = await TodoService.GetAllAsync();
    }
}