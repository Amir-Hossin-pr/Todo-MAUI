@using Todo_Maui_Blazor.Services
@using Todo_Maui_Blazor.Models

@inject ITodoService TodoService
@inject ISnackbar Snackbar

<MudDialog>
    <DialogContent>
        <MudTextField T="string" Label="عنوان" @bind-Value="Title" Variant="@Variant.Outlined" />
        <MudTextField T="string" Label="متن" Lines="4" @bind-Value="Text" Variant="@Variant.Outlined" />
    </DialogContent>
    <DialogActions>
        <MudButton Class="rounded-lg" Color="Color.Error" OnClick="Cancel" Variant="@Variant.Filled" FullWidth="true" Size="Size.Large">لفو</MudButton>
        <MudButton Class="rounded-lg" Color="Color.Primary" OnClick="Submit" Variant="@Variant.Filled" FullWidth="true" Size="Size.Large">ذخیره</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    [Parameter] public string Title { get; set; }

    [Parameter] public string Text { get; set; }

    [Parameter] public int? Id { get; set; }

    async void Submit()
    {
        Todo item;
        if (Id != null)
        {
            item = await TodoService.GetAsync(Id.Value);
            item.Title = Title;
            item.Text = Text;
            if (await TodoService.UpdateAsync(item))
            {
                MudDialog.Close(DialogResult.Ok(new { Status = true, item }));
                Snackbar.Add($"{Title} آپدیت شد");
            }
            else
            {
                MudDialog.Close(DialogResult.Ok(new { Status = false }));
                Snackbar.Add("خطایی رخ داد", Severity.Error);
            }

        }
        else
        {
            item = new()
                {
                    Title = Title,
                    Text = Text
                };

            if (await TodoService.InseretAsync(item))
            {
                MudDialog.Close(DialogResult.Ok(new { Status = true, item }));
                Snackbar.Add($"{Title} افزوده شد");
            }
            else
            {
                MudDialog.Close(DialogResult.Ok(new { Status = false }));
                Snackbar.Add("خطایی رخ داد", Severity.Error);
            }
        }

    }

    void Cancel() => MudDialog.Cancel();
}
